---
layout: post
title: etcd
date: 2022-07-14
tags:  etcd
---

# etcd的应用场景
1. 服务发现 在同一个分布式集群中的进程或服务，要如何才能找到对方并建立链接
2. 配置中心 将一些配置信息放到etcd上进行管理
   1. 节点启动时主动从etcd获取一次配置信息，同时在etcd节点上注册一个watcher并等待，这样以后每次配置有更新的时候，etcd都会实时通知订阅者。
3. 分布式锁 etcd底层实现了Raft库来保证数据的强一致性，这样某一次操作存储到集群中的值一定是全局一致的
   1. 保持独立 保持独立也就是获得锁的用户最终只有一个可以得到，etcd有一套原子操作CAS的接口。通过设置prevExist值，可以保证在多节点同时操作时，只有一个成功，这样操作成功的用户就可以认为拿到了锁。
   2. 控制时序 即所有想要获得锁的用户都会被安排执行，同时获得锁的顺序也是全局唯一的。etcd 为此也提供了一套 API（自动创建有序键），对一个目录建值时指定为POST动作，这样 etcd 会自动在目录下生成一个当前最大的值为键，存储这个新的值（客户端编号）。同时还可以使用 API 按顺序列出所有当前目录下的键值。此时这些键的值就是客户端的时序，而这些键中存储的值可以是代表客户端的编号。

# etcd与zookeeper相比的优势
1. Zookeeper部署维护复杂，其使用的Paxos强一致性算法复杂难懂。
2. Zookeeper官方只提供了Java和C两种语言的接口。
3. 使用Java编写引入大量的依赖。运维人员维护起来比较麻烦。
4. Zookeeper最近几年发展缓慢，不如etcd和consul等后起之秀。
5. 简单。使用 Go 语言编写部署简单；支持HTTP/JSON API,使用简单；使用 Raft 算法保证强一致性让用户易于理解。
6. etcd 默认数据一更新就进行持久化。
7. etcd 支持 SSL 客户端安全认证(https)。

**Kubernetes内部也使用了etcd作为存储配置信息**


